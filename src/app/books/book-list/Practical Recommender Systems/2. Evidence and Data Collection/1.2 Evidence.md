# Evidence Collector & Logger (Isolate from Existing Applications)

## Overall Architecture

- ![](/books/Practical%20Recommender%20Systems/evidence%20collector.jpg)

## Evidence Collector

- (the client side): use JS function to post evidence
    ```javascript
    function add_impression(user_id, event_type, content_id,
                            session_id, csrf_token)
    {
        $.ajax(
            type: 'POST',
            url: '/collect/log/',
            data: {
                    "csrfmiddlewaretoken": csrf_token,
                    "event_type": event_type,
                    "user_id": user_id,
                    "content_id": content_id,
                    "session_id": session_id
            },
            fail: function(){ 
                    console.log('log failed(' + event_type + ')')
            }
        })
    };
    ```

## Evidence Logger

- (the server side): use web API to receive data collection requests, and save data into CSV file
- Data Model of An Evidence Logger
  - ![](/books/Practical%20Recommender%20Systems/data%20model%20-%20evidence%20logger.jpg)
- RESTful API
  ```python
  @ensure_csrf_cookie
  def log(request):

  if request.method == 'POST':
      date = request.GET.get('date', datetime.datetime.now())

      user_id = request.POST['user_id']
      content_id = request.POST['content_id']
      event = request.POST['event_type']
      session_id = request.POST['session_id']

      l = Log(
          created=date,
          user_id=user_id,
          content_id=str(content_id),
          event=event,
          session_id=str(session_id))
      l.save()
  else:
      HttpResponse('log only works with POST')

  return HttpResponse('ok')
  ```